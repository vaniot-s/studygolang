(function(){SG.User=function(){},SG.User.prototype={edit:function(i){var r=$(i).text();$(i).text("稍等").addClass("disabled").attr({title:"稍等",disabled:"disabled"});var t=$(i).parents("form"),e=t.serialize(),a=t.attr("action");$.ajax({type:"post",url:a,data:e,dataType:"json",success:function(t){t.ok?(comTip("修改成功！"),setTimeout(function(){window.location.reload()},1e3)):comTip(t.error)},complete:function(t,e){$(i).text(r).removeClass("disabled").removeAttr("disabled").attr({title:r})},error:function(t,e,a){$(i).text(r).removeClass("disabled").removeAttr("disabled").attr({title:r}),403==t.status&&comTip("没有编辑权限")}})},parseCmtContent:function(t){t.each(function(){var t=$(this).html();marked=SG.markSettingNoHightlight(),$(this).html(marked(t)),emojify.setConfig({only_crawl_id:null,img_dir:SG.EMOJI_DOMAIN,ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1}}),emojify.run(this)})}},jQuery(document).ready(function(s){var e=new SG.User;e.parseCmtContent(s(".recent-comments ul li .content")),s(".submit").on("click",function(t){if(t.preventDefault(),!s(this).parents(".validate-form").validate().form())return!1;e.edit(this)}),s("#active_email").on("click",function(t){return t.preventDefault(),s.ajax({type:"post",url:"/account/send_activate_email",dataType:"json",success:function(t){t.ok?comTip("激活邮件已发到您邮箱，请查收！"):comTip(t.error)},error:function(t,e,a){403==t.status&&comTip("没有操作权限")}}),!1}),s("#avatar-tab a").click(function(t){t.preventDefault(),s(this).tab("show")}),s(".btn-gravatar").on("click",function(t){t.preventDefault();var e=s(this).attr("href");s.ajax({type:"post",url:e,data:{avatar:""},dataType:"json",success:function(t){t.ok?(comTip("操作成功！"),setTimeout(function(){window.location.reload()},1e3)):comTip(t.error)},error:function(t,e,a){403==t.status&&comTip("没有操作权限")}})});var t=new plupload.Uploader({browse_button:"btn-upload-avatar",url:"/image/upload",filters:{mime_types:[{title:"图片文件",extensions:"jpg,png"}],max_file_size:"500k",prevent_duplicates:!0},multipart_params:{avatar:"1"},multi_selection:!1,file_data_name:"img",resize:{width:600}});t.init(),t.bind("FilesAdded",function(t,e){t.start()}),t.bind("UploadProgress",function(t,e){}),t.bind("FileUploaded",function(t,e,a){if(200==a.status){var i=s.parseJSON(a.response);if(i.ok){var r=i.data.uri,o=i.data.url,n=s("#img-preview").find("img");n.attr("src",o),n.attr("alt",e.name),s("#img-preview").show(),s("#upload-avatar").val(r.substr(7)),s("#upload-btn").removeAttr("disabled")}else comTip("上传失败："+i.error)}else comTip("上传失败：HTTP状态码："+a.status)}),t.bind("Error",function(t,e){comTip("上传出错了："+e.message)})})}).call(this);